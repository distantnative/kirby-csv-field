(function(){"use strict";function p(t,e,n,a,r,l,u,b){var i=typeof t=="function"?t.options:t;e&&(i.render=e,i.staticRenderFns=n,i._compiled=!0),a&&(i.functional=!0),l&&(i._scopeId="data-v-"+l);var o;if(u?(o=function(s){s=s||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!s&&typeof __VUE_SSR_CONTEXT__<"u"&&(s=__VUE_SSR_CONTEXT__),r&&r.call(this,s),s&&s._registeredComponents&&s._registeredComponents.add(u)},i._ssrRegister=o):r&&(o=b?function(){r.call(this,(i.functional?this.parent:this).$root.$options.shadowRoot)}:r),o)if(i.functional){i._injectStyles=o;var g=i.render;i.render=function(k,d){return o.call(d),g(k,d)}}else{var f=i.beforeCreate;i.beforeCreate=f?[].concat(f,o):[o]}return{exports:t,options:i}}const c={extends:"k-files-field",props:{columns:Object,limit:Number},data(){return{rows:null,pagination:null}},computed:{cols(){return this.columns?Object.fromEntries(Object.keys(this.columns).map(t=>[this.columns[t].key??t,this.columns[t]])):this.rows?Object.fromEntries(Object.keys(this.rows[0]).map(t=>[t,{label:t}])):[]},file(){return this.value[0]},index(){return this.limit?(this.pagination.page-1)*this.pagination.limit+1:null}},watch:{file:{async handler(){this.preview()},immediate:!0}},methods:{async preview(t=1){if(this.file){const{rows:e,pagination:n}=await this.$api.get(this.endpoints.field+"/preview",{file:this.file.id,page:t});this.rows=e,this.pagination=n}else this.rows=null}}};var h=function(){var e=this,n=e._self._c;return n("k-field",e._b({staticClass:"k-models-field k-csv-field",scopedSlots:e._u([e.disabled?null:{key:"options",fn:function(){return[e.file?n("k-button",{attrs:{responsive:!0,text:e.$t("remove"),icon:"remove",size:"xs",variant:"filled"},on:{click:function(a){return e.remove(0)}}}):n("k-button-group",{ref:"buttons",staticClass:"k-field-options",attrs:{buttons:e.buttons,layout:"collapsed",size:"xs",variant:"filled"}})]},proxy:!0}],null,!0)},"k-field",e.$props,!1),[n("k-dropzone",{attrs:{disabled:!e.hasDropzone},on:{drop:e.drop}},[e.rows?n("k-table",{attrs:{columns:e.cols,index:e.index,rows:e.rows,pagination:e.pagination?{...e.pagination,details:!0}:!1},on:{paginate:function(a){return e.preview(e.pagination.page+1)}}}):e.file?n("k-empty",{attrs:{text:e.$t("field.csv.loading"),icon:"loader",layout:"table"}}):n("k-empty",{attrs:{text:e.$t("field.csv.empty"),icon:"table",layout:"table"},on:{click:e.open}})],1)],1)},v=[],_=p(c,h,v,!1,null,null,null,null);const m=_.exports;panel.plugin("distantnative/kirby-csv-field",{fields:{csv:m}})})();
